/*
* Package:
* j2crypt-js.js @ 1.3 by Tomas Molinari @toomeenoo <tomie.molinari@gmail.com>
* jquery.binarytransport.js @ 1.0 by Henry Algus <henryalgus@gmail.com>
*/
function J2crypt(){return this.map={width:1,height:1,data:[0]},this.password="0",this.passwordSize=1,this}J2crypt.prototype.setPwd=function(t){return this.password=t,this.passwordSize=t.length,this},J2crypt.prototype.setMapJson=function(t){this.map=JSON.parse(t),this.map.data=[];for(var r=0;r<this.map.dataHex.length;)this.map.data.push(parseInt(this.map.dataHex.substr(r,2),16)),r+=2;return delete this.map.dataHex,this},J2crypt.prototype.post=function(t,r,n){var o=this;return window.jQuery.post(t,r,function(t){o.unlock(t,n)},"binary")},J2crypt.prototype.get=function(t,r,n){var o=this;return window.jQuery.get(t,r,function(t){o.unlock(t,n)},"binary")},J2crypt.prototype.cpost=function(t,r,n){var o=this;return window.jQuery.post(t,{j2crypt:this.lock("object"==typeof r?JSON.stringify(r):r)},function(t){o.unlock(t,n)},"binary")},J2crypt.prototype.cget=function(t,r,n){var o=this;return window.jQuery.get(t,{j2crypt:this.lock("object"==typeof r?JSON.stringify(r):r)},function(t){o.unlock(t,n)},"binary")},J2crypt.prototype.unlock=function(t,r){var n=this,o=new FileReader;o.onload=function(t){var o="";Array.prototype.map.call(new Uint8Array(t.target.result),function(t){o+=("00000000"+parseInt(t).toString(2)).substr(-8)});for(var a=[];o.length>=7;)a.push(parseInt("00"+o.substr(0,7),2)),o=o.substr(7);r(n.array7unlock(a))},o.readAsArrayBuffer(t)},J2crypt.prototype.b64unlock=function(t){for(var r=atob(t),n=new Array(r.length),o=0;o<r.length;o++)n[o]=r.charCodeAt(o);var a="";Array.prototype.map.call(new Uint8Array(n),function(t){a+=("00000000"+parseInt(t).toString(2)).substr(-8)});for(var s=[];a.length>=7;)s.push(parseInt("00"+a.substr(0,7),2)),a=a.substr(7);return this.array7unlock(s)},J2crypt.prototype.array7unlock=function(t){if(!(t instanceof Array&&"number"==typeof t[0]))return null;for(var r=0,n=0,o=0,a=t[0],s=t[1],e=t[2],i="",p=t.length;r+3<p;){for(o=0;r+3<p&&o<a;){for(var h=o%this.map.width,u=n%this.map.height,c=this.map.data[h+u*this.map.width],f=this.password.charCodeAt((r+e)%this.passwordSize),y=128;c+f>y;)y+=128;i+=String.fromCharCode((y-(c+f)+t[r+3])%128),o++,r++}n++}for(;s!=i.charCodeAt(i.length-1)&&i.length;)i=i.substr(0,i.length-1);return console.log("Data stat: ",a,e,s),i},J2crypt.prototype.lock=function(t){function r(t){return("0000000"+t.toString(2)).substr(-7)}for(var o=function t(r,o){for(o=o||128,b=r,a=1,nums=[2,3,5,7,11,13],y=0;y<6;){for(n=nums[y];!(b%n)&&a*n+b/n<a+b&&a*n<o;)a*=n,b/=n;y++}return a*n<o&&a<b/3?t(r+1):[a,b,r]}(t.length),s=Math.floor(127*Math.random()),e=o[0],i=t.charCodeAt(t.length-1),p=t.length,h=[e,i,s],u=""+r(e)+r(i%128)+r(s),c="",y=0,l=0,d=0;y<p&&l<i;){for(d=0;y<p&&d<e;){var g=d%this.map.width,w=l%this.map.height,m=this.map.data[g+w*this.map.width];for(ps=this.password.charCodeAt((y+s)%this.passwordSize),f=(t.charCodeAt(y)+m+ps)%128,h.push(f),u+=("0000000"+f.toString(2)).substr(-7);u.length>=8;)c+=("00"+parseInt(u.substr(0,8),2).toString(16)).substr(-2),u=u.substr(8);d++,y++}l++}if(u.length){for(;u.length%8;)u+="0";for(;u.length>0;)c+=("00"+parseInt(u.substr(0,8),2).toString(16)).substr(-2),u=u.substr(8)}return this.precomputed=h,this.hexadec=c,btoa(c.match(/\w{2}/g).map(function(t){return String.fromCharCode(parseInt(t,16))}).join(""))};